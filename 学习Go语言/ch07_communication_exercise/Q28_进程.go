/*
Q28. (2) 进程
1. 编写一个程序，列出所有正在运行的进程，并打印每个进程执行的子进程个数。输出应当类似：
Pid 0 has 2 children: [1 2]
Pid 490 has 2 children: [1199 26524]
Pid 1824 has 1 child: [7293]
	• 为了获取进程列表，需要得到 ps -e -opid,ppid,comm 的输出。输出类似：
		PID PPID COMMAND
		9024 9023 zsh
		19560 9024 ps
	• 如果父进程有一个子进程， 就打印 child， 如果多于一个， 就打印
children；
	• 进程列表要按照数字排序，这样就以 pid 0 开始，依次展示。
这里有一个 Perl 版本的程序来帮助上手（或者造成绝对的混乱）。

Listing 7.5. Perl 显示进程

#!/usr/bin/perl -l
my (%child, $pid, $parent);
my @ps=`ps -e -opid,ppid,comm` ; # Capture the output
	from `ps`
	foreach (@ps[1..$#ps]) { # Discard the header line
	($pid, $parent, undef) = split; # Split the line, discard 'comm'
	push @{$child{$parent} }, $pid; # Save the child PIDs on a list
}
# Walk through the sorted PPIDs
foreach (sort { $a <=> $b } keys %child) {
	print "Pid ", $_, " has ", @{$child{$_} }+0, " child",
		@{$child{$_} } == 1 ? ": " : "ren: ", "[@{$child{$_} }
			]" ;
}
*/
/*
1. 有许多工作需要做。可以将程序分为以下几个部分：
1. 运行 ps 获得输出；
2. 解析输出并保存每个 PPID 的子 PID；
3. 排序 PPID 列表；
4. 打印排序后的列表到屏幕。
在下面的解法中，使用了一个 map[int][]int，就是一个使用整数作为 map 的
索引，元素是整数的 slice ——用于保存 PID。内建的 append 被用于扩展这个
整数的 slice
*/
package main

import (
	"fmt"
	"os/exec"
	"sort"
	"strconv"
	"strings"
)

func main() {
	ps := exec.Command("ps", "-e", "-opid,ppid,comm")
	output, _ := ps.Output()
	child := make(map[int][]int)
	for i, s := range strings.Split(string(output), "\n") {
		if i == 0 {
			continue // kill first line
		}
		if len(s) == 0 {
			continue // kill last line
		}
		f := strings.Fields(s)
		fpp, _ := strconv.Atoi(f[1])
		fp, _ := strconv.Atoi(f[0])
		child[fpp] = append(child[fpp], fp)
	}
	schild := make([]int, len(child))
	i := 0
	for k, _ := range child {
		schild[i] = k
		i++
	}
	sort.Ints(schild)
	for _, ppid := range schild {
		fmt.Printf("Pid %d has %d child", ppid, len(child[ppid]))
		if len(child[ppid]) == 1 {
			fmt.Printf(": %v\n", child[ppid])
			continue
		}
		fmt.Printf("ren: %v\n", child[ppid])
	}
}

/*
[root@SGDLITVM0734 ~]# go run process.go
Pid 0 has 2 children: [1 2]
Pid 1 has 55 children: [2686 2725 2728 5093 5118 5119 5120 5121 5125 5129 5130 5131 5133 5134 5136 5141 5142 5143 5152 5155 5181 5188 5213 5480 5481 5482 5485 5492 5500 5502 5514 5515 5661 5884 5906 5940 5941 5948 5955 5993 6004 6031 6036 6044 6054 6058 6060 6136 9110 9170 9171 9196 13040 14986 16772]
Pid 2 has 889 children: [3 7 8 9 10 11 12 13 14 17 18 19 21 22 23 24 28 29 30 31 32 33 34 35 36 37 38 39 45 46 47 48 56 59 60 62 64 77 110 390 465 467 475 476 477 478 479 480 481 482 523 527 532 533 534 535 536 537 538 539 713 724 729 772 780 786 787 788 789 790 791 792 793 844 854 894 899 904 908 920 924 1015 1741 1744 1749 1750 1751 1752 1753 1754 1755 1756 2011 2016 2026 2030 2036 2044 2045 2046 2047 2050 2439 2444 2447 2448 2449 2450 2451 2452 2453 2454 2541 2542 2555 2558 2564 2569 2573 2578 2586 2587 2594 2595 2596 2597 2598 2599 2600 2603 2610 2611 2612 2613 2614 2615 2616 2617 2714 2715 2914 3306 3310 3313 3314 3315 3316 3317 3318 3319 3320 3377 3381 3390 3391 3392 3393 3394 3395 3396 3397 3647 3648 3651 3652 3666 3667 3668 3669 3670 3671 3672 3674 3676 3677 3678 3679 3682 3683 3684 3692 3918 3924 3932 3940 3941 3943 3952 3953 3954 3955 4478 4479 4487 4498 4501 4505 4519 4543 4746 4753 4770 4771 4772 4773 4774 4775 4776 4779 4783 4786 4796 4797 4798 4799 4800 4801 4802 4803 5250 5255 5270 5275 5278 5279 5280 5281 5282 5283 5284 5285 5299 5302 5313 5315 5317 5319 5321 5323 5396 5399 5413 5414 5415 5417 5418 5419 5420 5421 5495 5503 5511 5512 5513 5516 5520 5521 5522 5523 6129 6139 6144 6145 6149 6150 6151 6152 6153 6154 6320 6324 6329 6330 6331 6332 6333 6334 6335 6336 6526 6534 6555 6556 6557 6558 6559 6560 6561 6563 6927 6977 6982 6989 6990 6991 6992 6993 6994 6995 6996 7134 7148 7149 7157 7158 7159 7161 7162 7163 7164 7166 7456 7467 7478 7480 7481 7482 7483 7484 7486 7489 7522 7526 7529 7530 7531 7532 7533 7534 7535 7536 7747 7749 7758 7759 7760 7761 7762 7763 7764 7765 7778 7787 7818 7819 7822 7826 7827 7828 7829 7830 7887 8382 8677 8681 8684 8685 8686 8687 8688 8689 8690 8691 8908 8912 8916 8917 8918 8919 8920 8921 8922 8923 9176 9177 9182 9183 9184 9185 9186 9187 9188 9189 9650 9755 9759 9763 9764 9765 9766 9767 9768 9769 9770 10154 10159 10162 10163 10164 10165 10166 10167 10168 10169 10311 10320 10328 10329 10330 10331 10335 10339 10340 10341 10365 10562 10567 10570 10571 10572 10573 10574 10575 10576 10577 11942 11946 11950 11951 11952 11953 11954 11955 11956 11957 12073 12103 12257 12260 12276 12277 12278 12279 12280 12281 12282 12284 12981 12984 12992 12993 12995 12998 12999 13000 13002 13003 13074 13076 13081 13099 13107 13109 13110 13111 13112 13290 13294 13319 13320 13321 13322 13323 13324 13332 13333 13602 13621 13645 13646 13647 13648 13649 13650 13651 13652 15140 15482 15488 15492 15493 15494 15495 15496 15497 15498 15499 15674 15679 15682 15683 15684 15685 15686 15687 15688 15689 15919 16059 16064 16067 16068 16069 16070 16071 16072 16073 16074 16203 16208 16212 16214 16215 16216 16217 16218 16219 16224 16250 16254 16257 16258 16259 16260 16261 16262 16263 16264 16348 16351 16357 16358 16359 16360 16361 16362 16363 16364 16727 16731 16738 16739 16740 16741 16742 16743 16744 16745 16899 16901 16929 16930 16932 16933 16934 16935 16937 16938 17013 17021 17028 17029 17030 17031 17032 17033 17034 17036 17855 17860 17863 17864 17865 17866 17867 17868 17869 17870 18238 18242 18245 18246 18247 18248 18249 18250 18251 18252 18449 18454 18460 18461 18462 18463 18464 18465 18466 18467 18708 18713 18716 18717 18718 18719 18720 18721 18722 18723 18937 18945 18961 18962 18963 18964 18965 18966 18967 18968 18998 19003 19006 19007 19008 19009 19010 19011 19012 19013 19033 19879 20056 21018 21266 21329 21332 21336 21337 21338 21339 21340 21341 21342 21343 21370 21375 21382 21383 21384 21385 21386 21387 21389 21396 21682 21685 21689 21690 21691 21692 21693 21694 21695 21696 22163 22168 22179 22180 22182 22183 22188 22190 22191 22192 22407 22415 22425 22426 22427 22428 22429 22430 22431 22432 22569 22581 22584 22585 22586 22587 22588 22589 22590 22591 22702 22704 22711 22712 22713 22714 22715 22716 22717 22718 23290 23507 23511 23515 23516 23517 23518 23519 23520 23521 23522 23756 23760 23765 23766 23767 23768 23769 23770 23771 23772 23915 24097 24908 26002 26007 26010 26011 26012 26013 26014 26015 26016 26017 26235 26238 26242 26243 26244 26245 26246 26247 26248 26249 26580 26590 26611 26612 26613 26614 26615 26616 26617 26618 26950 26955 26958 26959 26960 26961 26962 26963 26964 26966 27349 27351 27366 27367 27368 27369 27370 27371 27372 27373 28188 29282 29709 29715 29722 29723 29724 29726 29729 29731 29732 29734 30165 30176 30198 30203 30217 30218 30232 30238 30239 30240 30261 30266 30284 30285 30286 30291 30292 30294 30295 30296 30571 30576 30579 30580 30581 30582 30583 30584 30585 30586 31076 31084 31088 31089 31090 31091 31092 31093 31094 31095 31553 31559 31562 31563 31564 31565 31566 31567 31568 31569 31670 31674 31680 31681 31682 31683 31684 31685 31686 31687 31916 31922 31951 31952 31953 31954 31955 31956 31960 31964 32236 32240 32243 32244 32245 32246 32247 32248 32249 32250 32478 32491 32511 32512 32513 32514 32515 32517 32518 32519]
Pid 416 has 1 child: [522]
Pid 453 has 1 child: [501]
Pid 490 has 1 child: [544]
Pid 522 has 1 child: [529]
Pid 540 has 1 child: [604]
Pid 833 has 1 child: [918]
Pid 1694 has 1 child: [2172]
Pid 1760 has 1 child: [1824]
Pid 1972 has 1 child: [2048]
Pid 2085 has 1 child: [2182]
Pid 2172 has 1 child: [416]
Pid 2455 has 1 child: [2502]
Pid 2618 has 1 child: [2716]
Pid 2716 has 4 children: [2927 13676 13677 13681]
Pid 3321 has 1 child: [3423]
Pid 3404 has 1 child: [3428]
Pid 3423 has 1 child: [4250]
Pid 3428 has 1 child: [3545]
Pid 3680 has 1 child: [3707]
Pid 3712 has 1 child: [3801]
Pid 3801 has 1 child: [4491]
Pid 3981 has 1 child: [4024]
Pid 4250 has 3 children: [5854 5855 5857]
Pid 4491 has 3 children: [6205 6206 6208]
Pid 4812 has 1 child: [4921]
Pid 4816 has 1 child: [4883]
Pid 5093 has 1 child: [5095]
Pid 5095 has 1 child: [5097]
Pid 5119 has 1 child: [5123]
Pid 5213 has 1 child: [28532]
Pid 5286 has 1 child: [5332]
Pid 5332 has 1 child: [5439]
Pid 5349 has 1 child: [5410]
Pid 5424 has 1 child: [5571]
Pid 5439 has 19 children: [6819 6821 6822 6823 6824 6825 6826 9583 9602 9611 9612 9613 9618 9619 9622 9634 9639 9641 9642]
Pid 5480 has 4 children: [1694 1972 18361 18810]
Pid 5532 has 1 child: [5622]
Pid 5571 has 1 child: [7523]
Pid 5661 has 2 children: [1884 5663]
Pid 5855 has 1 child: [32531]
Pid 5857 has 404 children: [945 1071 1153 1154 1155 3301 3308 3312 3349 6221 6223 6224 6225 6226 6227 6230 6231 6235 6236 6237 6238 6239 6242 6243 6244 6245 6248 6249 6251 6252 6254 6255 6256 6257 6258 6259 6260 6264 6265 6266 6269 6270 6271 6272 6273 6274 6275 6276 6277 6278 6279 6280 6281 6282 6283 6284 6285 6286 6287 6288 6289 6290 6294 6296 6297 6298 6299 6301 6302 6304 6306 6307 6308 6312 6313 6314 6316 6321 6322 6323 6326 6327 6352 6358 6359 6362 6363 6364 6368 6371 6372 6373 6374 6375 6376 6377 6378 6380 6383 6385 6386 6387 6388 6389 6390 6391 6392 6393 6394 6395 6396 6397 6398 6399 6400 6401 6403 6404 6405 6406 6407 6409 6410 6411 6413 6414 6415 6416 6418 6419 6421 6422 6423 6424 6425 6426 6427 6428 6429 6430 6431 6432 6434 6435 6436 6437 6438 6439 6440 6441 6442 6443 6444 6446 6449 6450 6451 6452 6453 6454 6455 6456 6457 6458 6459 6460 6461 6462 6463 6464 6465 6466 6469 6470 6471 6475 6476 6478 6479 6480 6481 6482 6483 6484 6485 6486 6487 6488 6490 6491 6492 6493 6494 6496 6497 6498 6499 6500 6501 6502 6503 6504 6505 6506 6507 6508 6509 6510 6511 6512 6513 6516 6517 6518 6520 6521 6522 6523 6524 6525 6527 6528 6529 6530 6531 6532 6533 6535 6537 6538 6540 6541 6542 6543 6544 6545 6546 6547 6548 6549 6550 6551 6552 6553 6554 6562 6564 6565 6566 6567 6568 6569 6570 6572 6573 6574 6575 6583 6585 6586 6587 6588 6589 6591 6592 6593 6594 6595 6596 6597 6598 6599 6600 6601 6602 6603 6606 6607 6608 6610 6611 6613 6614 6615 6616 6617 6618 6619 6620 6621 6623 6624 6625 6626 6627 6628 6629 6630 6631 6632 6634 6635 6636 6638 6641 6643 6644 6645 6646 6648 6649 6650 6651 6652 6653 6654 6655 6656 6657 6658 6659 6660 6661 6662 6663 6664 6665 6667 6668 6669 6670 6671 6672 6673 6674 6675 6676 6677 6678 6680 6681 6682 6684 6685 6686 6694 6695 6697 6702 6703 6704 6705 6706 6708 6709 6710 6711 6712 6714 6721 6722 6724 6728 6731 6736 6738 6741 6744 6752 6754 6756 6758 6763 6764 6765 6766 6767 6768 6769 6770 6771 6772 6774 7067 7068 7069 7071 8601 11823 11834 13300 15000 15002 15003 15005 15234 17455 17566 18817 27944 28062 28370 28372 28831]
Pid 5884 has 1 child: [5885]
Pid 5906 has 2 children: [5914 5930]
Pid 5930 has 1 child: [5934]
Pid 5934 has 18 children: [5984 6065 6069 6071 6074 6075 6076 6077 6080 6085 6090 6095 6096 6102 6108 6112 6113 6119]
Pid 5948 has 1 child: [5953]
Pid 5984 has 1 child: [6025]
Pid 6025 has 2 children: [6028 6188]
Pid 6156 has 1 child: [6214]
Pid 6206 has 1 child: [32504]
Pid 6208 has 404 children: [382 383 384 514 517 582 733 744 784 1020 1021 1534 1625 1648 1825 1826 2035 2251 2274 2279 2281 2371 2372 2405 2559 2651 2666 2898 3183 3307 3311 3452 3596 3646 3702 3756 4016 4165 4184 4222 4381 4441 4457 4473 4735 4737 4983 4986 5084 5597 5805 5967 6253 6261 6291 6325 6328 6720 6805 6814 6846 6883 6907 6930 6932 6935 6965 6976 7030 7077 7114 7119 7135 7167 7224 7260 7261 7265 7266 7305 7339 7340 7381 7397 7401 7402 7416 7707 7712 7732 7927 8059 8097 8375 8527 8575 8756 8808 8811 8842 8865 9374 9376 9377 9378 9662 9854 9855 9856 9857 9880 9881 9907 9908 10137 10141 10146 10268 10304 10393 10451 10452 10821 10848 11072 11097 11190 11192 11355 11552 11649 11652 11708 11709 11734 11792 11793 11803 11944 11974 12047 12049 12068 12136 12286 12420 12440 12448 12504 12683 12756 12777 13159 13287 13288 13289 13540 13545 13747 13919 14080 14120 14240 14310 14311 14392 14506 14516 14530 14536 14647 14726 14840 14876 14877 14892 14893 14900 14959 14960 15039 15060 15064 15067 15144 15591 15713 15753 15760 15773 15863 15920 15958 16128 16309 16315 16316 16324 16330 16384 16407 16433 16525 16564 16565 16749 16832 16880 16900 16947 17088 17271 17552 17553 17567 17615 18111 18184 18448 18557 18823 18900 18910 19030 19072 19075 19133 19226 19276 19284 19286 19420 19422 19596 19753 19892 19979 20153 20155 20161 20184 20315 20316 20359 20432 20511 20518 20519 20623 20652 20660 21003 21004 21056 21088 21188 21285 21362 21363 21409 21410 21539 21564 21565 21749 21751 21785 21920 22261 22325 22326 22406 22424 22486 22487 22878 22931 22932 22933 22971 23013 23084 23183 23282 23338 23340 23502 23640 23642 23657 23667 23680 23864 23937 23938 23977 24259 24479 24592 24667 24692 24693 24793 24801 24912 24964 24998 25140 25295 25369 25680 25714 25788 26137 26378 26462 26529 26530 26536 26557 26558 26683 26831 26853 27047 27134 27135 27390 27574 27766 27781 27933 27999 28013 28056 28060 28201 28354 28478 28648 28836 28864 29008 29106 29285 29291 29354 29364 29398 29404 29408 29449 29759 29763 29797 29801 29893 30028 30029 30104 30150 30179 30187 30436 30452 30516 30622 30649 31015 31099 31101 31326 31328 31332 31338 31388 31389 31423 31481 31734 31850 31852 31853 31865 31920 31929 31977 32007 32008 32009 32131 32138 32145 32146 32147 32307 32472 32510 32629 32691 32693 32701 32737 32750]
Pid 6343 has 1 child: [6381]
Pid 6576 has 1 child: [6679]
Pid 6997 has 1 child: [7023]
Pid 7023 has 1 child: [7199]
Pid 7173 has 1 child: [7249]
Pid 7199 has 1 child: [7211]
Pid 7211 has 1 child: [8225]
Pid 7249 has 1 child: [7492]
Pid 7492 has 1 child: [7547]
Pid 7501 has 1 child: [7577]
Pid 7523 has 1 child: [7593]
Pid 7537 has 1 child: [7554]
Pid 7547 has 1 child: [8440]
Pid 7554 has 1 child: [8308]
Pid 7767 has 1 child: [7814]
Pid 7832 has 1 child: [7872]
Pid 8225 has 5 children: [20735 20736 20737 20738 20739]
Pid 8440 has 5 children: [20841 20842 20843 20845 20863]
Pid 8692 has 1 child: [8779]
Pid 8779 has 1 child: [8871]
Pid 8871 has 1 child: [21581]
Pid 8924 has 1 child: [8986]
Pid 9771 has 1 child: [9823]
Pid 9823 has 2 children: [9982 9983]
Pid 9982 has 1 child: [30902]
Pid 9983 has 1 child: [9996]
Pid 9996 has 1 child: [10703]
Pid 10170 has 1 child: [10194]
Pid 10344 has 1 child: [10410]
Pid 10581 has 1 child: [10617]
Pid 10703 has 5 children: [19040 19041 19042 19043 19044]
Pid 11967 has 1 child: [12008]
Pid 12008 has 1 child: [12212]
Pid 12212 has 1 child: [14014]
Pid 12292 has 1 child: [12370]
Pid 13019 has 1 child: [13084]
Pid 13040 has 1 child: [13048]
Pid 13048 has 77 children: [490 540 833 1760 2085 2455 2618 3321 3404 3680 3712 3981 4812 4816 5286 5349 5424 5532 6156 6343 6576 6997 7173 7501 7537 7767 7832 8692 8924 9771 10170 10344 10581 11967 12292 13019 13352 13675 15512 15690 16075 16235 16265 16408 16760 16956 17048 17871 18253 18472 18724 18969 19014 21344 21414 21702 22209 22453 22651 22719 23537 23774 26018 26251 26629 26972 27374 29743 30267 30302 30587 31110 31580 31713 32015 32252 32533]
Pid 13084 has 2 children: [13310 13311]
Pid 13310 has 1 child: [31874]
Pid 13311 has 1 child: [13318]
Pid 13318 has 1 child: [14128]
Pid 13352 has 1 child: [13451]
Pid 13675 has 1 child: [13739]
Pid 14014 has 1 child: [14027]
Pid 14027 has 2 children: [14398 14399]
Pid 14128 has 5 children: [20087 20088 20089 20090 20092]
Pid 14398 has 20 children: [6070 12643 13910 16135 19102 19103 19104 19105 19106 19107 22482 22483 26547 26548 28245 30511 30512 30513 30518 32746]
Pid 14399 has 1 child: [20289]
Pid 15512 has 1 child: [15542]
Pid 15690 has 1 child: [15730]
Pid 15730 has 1 child: [15805]
Pid 16075 has 1 child: [16110]
Pid 16235 has 1 child: [16369]
Pid 16265 has 1 child: [16308]
Pid 16408 has 1 child: [16482]
Pid 16760 has 1 child: [16796]
Pid 16956 has 1 child: [17070]
Pid 17048 has 1 child: [17118]
Pid 17871 has 1 child: [17934]
Pid 18253 has 1 child: [18302]
Pid 18302 has 1 child: [18373]
Pid 18361 has 1 child: [18625]
Pid 18472 has 1 child: [18520]
Pid 18520 has 2 children: [18712 18806]
Pid 18712 has 1 child: [31147]
Pid 18724 has 1 child: [18770]
Pid 18806 has 1 child: [19280]
Pid 18810 has 1 child: [19004]
Pid 18969 has 1 child: [19054]
Pid 19014 has 1 child: [19032]
Pid 21344 has 1 child: [21424]
Pid 21414 has 1 child: [21441]
Pid 21424 has 3 children: [21555 21719 22369]
Pid 21581 has 1 child: [21582]
Pid 21582 has 2 children: [29532 29533]
Pid 21702 has 1 child: [21747]
Pid 21719 has 1 child: [453]
Pid 22209 has 1 child: [22275]
Pid 22453 has 1 child: [22505]
Pid 22505 has 1 child: [22597]
Pid 22651 has 1 child: [22703]
Pid 22719 has 1 child: [22739]
Pid 23537 has 1 child: [23617]
Pid 23774 has 1 child: [23848]
Pid 26018 has 1 child: [26049]
Pid 26251 has 1 child: [26271]
Pid 26629 has 1 child: [26694]
Pid 26972 has 1 child: [27053]
Pid 27374 has 1 child: [27440]
Pid 29532 has 15 children: [2280 4306 4535 4537 4545 12644 13907 22484 22485 26546 26549 30510 30514 30515 30519]
Pid 29533 has 1 child: [5879]
Pid 29743 has 1 child: [29824]
Pid 30267 has 1 child: [30299]
Pid 30302 has 1 child: [30548]
Pid 30587 has 1 child: [30691]
Pid 31110 has 1 child: [31203]
Pid 31580 has 1 child: [31696]
Pid 31713 has 1 child: [31781]
Pid 32015 has 1 child: [32068]
Pid 32252 has 1 child: [32363]
Pid 32533 has 1 child: [32639]
*/
